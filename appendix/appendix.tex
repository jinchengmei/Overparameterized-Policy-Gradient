\documentclass[10pt]{article}
\usepackage[usenames]{color} %used for font color
\usepackage{amssymb} %maths
\usepackage{amsmath} %maths
\usepackage{amsthm}
\usepackage{hyperref}
\usepackage[utf8]{inputenc} %useful to type directly diacritic characters
\usepackage[capitalize]{cleveref}
\crefname{prop}{Proposition}{Propositions}
\crefname{thm}{Theorem}{Theorems}
\crefname{lem}{Lemma}{Lemmas}


\def\rva{{\mathbf{a}}}
\def\rvo{{\mathbf{o}}}
\def\rvr{{\mathbf{r}}}
\def\rvs{{\mathbf{s}}}
\def\rvu{{\mathbf{u}}}
\def\rvw{{\mathbf{w}}}
\def\rvx{{\mathbf{x}}}
\def\rvg{{\mathbf{g}}}
\def\rvo{{\mathbf{o}}}
\def\rvone{{\mathbf{1}}}
\def\rvzero{{\mathbf{0}}}
\def\rvtilder{{\tilde{\mathbf{r}}}}

\def\rvp{{\mathbf{p}}}

\def\pr{{\text{Pr}}}
\def\r{{\text{R}}}

\def\regret{{\text{Regret}}}

\newtheorem{thm}{Theorem}
\newtheorem{lem}{Lemma}
\newtheorem{defi}{Definition}
\newtheorem{prop}{Proposition}
\newtheorem{remk}{Remark}


\def\rvpi{{\boldsymbol{\pi}}}

\def\rmA{{\mathbf{A}}}
\def\rmI{{\mathbf{I}}}
\def\rmW{{\mathbf{W}}}
\def\rmX{{\mathbf{X}}}

\def\sE{{\mathbb{E}}}
\def\sR{{\mathbb{R}}}
\def\sI{{\mathbb{I}}}

\def\gH{{\mathcal{H}}}
\def\gN{{\mathcal{N}}}
\def\gE{{\mathcal{E}}}
\def\gU{{\mathcal{U}}}


\title{Appendix}
\author{}
\date{}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\probability}{Pr}
\DeclareMathOperator*{\expectation}{\sE}

\begin{document}

\maketitle

\section{Proofs}

\begin{lem}
    Denote $\gH\left( \rvpi_i \left(\rvo \right) \right) \triangleq \Delta \left( \rvpi_i \left(\rvo \right) \right) - \rvpi_i \left(\rvo \right) \rvpi_i \left(\rvo \right)^\top$.
\begin{equation*}
    \left\| \frac{d \gH\left( \rvpi_i \left(\rvo \right) \right) \rvtilder_i}{d \rvo } \right\|_2 \le 4.
\end{equation*}
\end{lem}
\begin{proof}
    Denote $\rmA \triangleq \frac{d \gH\left( \rvpi_i \left(\rvo \right) \right) \rvtilder_i}{d \rvo } \in \sR^{h \times h}$.
\begin{equation*}
\begin{split}
    A_{s, t} &= \frac{d \pi_{i,s} \left( \tilde{r}_{i,s} - \rvpi_i^\top \rvtilder_i \right) }{d o_t} \\
    &= \frac{d \pi_{i,s} }{d o_t} \left( \tilde{r}_{i,s} - \rvpi_i^\top \rvtilder_i \right) + \pi_{i,s} \frac{d \left( \tilde{r}_{i,s} - \rvpi_i^\top \rvtilder_i \right) }{d o_t} \\
    &=\left ( \sI\left\{ s = t\right\} \pi_{i,t} -  \pi_{i,s } \pi_{i,t} \right) \left( \tilde{r}_{i,s} - \rvpi_i^\top \rvtilder_i \right) - \pi_{i,s} \left( \pi_{i,t} \tilde{r}_{i,t} - \pi_{i,t} \rvpi_i^\top \rvtilder_i \right).
\end{split}
\end{equation*}
For any vector $\rvx \in \sR^h$, 
\begin{equation*}
\begin{split}
    \rvx^\top \rmA \rvx &= \sum\limits_{s=1}^{h}{ \sum\limits_{t=1}^{h}{ A_{s,t} x_s x_t} } \\
    &= \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \cdot \rvx \right] - \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \right] \cdot \expectation\limits_{\rvpi_i}\left[ \rvx \cdot \rvx \right] - \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \right] \cdot \expectation\limits_{\rvpi_i}\left[ \rvx \right] + \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \right] \cdot \left( \expectation\limits_{\rvpi_i}\left[ \rvx \right] \right)^2 \\
    &\qquad - \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \right] \cdot \expectation\limits_{\rvpi_i}\left[ \rvx \right] + \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \right] \cdot \left( \expectation\limits_{\rvpi_i}\left[ \rvx \right] \right)^2 \\
    &\le \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \cdot \rvx \right] - \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \right] \cdot \expectation\limits_{\rvpi_i}\left[ \rvx \right] - \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \cdot \rvx \right] \cdot \expectation\limits_{\rvpi_i}\left[ \rvx \right] + \expectation\limits_{\rvpi_i}\left[ \rvtilder_i \right] \cdot \left( \expectation\limits_{\rvpi_i}\left[ \rvx \right] \right)^2 \\
    &\le \left\| \rvpi_i \right\|_2 \cdot \left\| \rvtilder_i \cdot \rvx \cdot \rvx \right\|_2 + 2 \cdot \left\| \rvpi_i \right\|_2 \cdot \left\| \rvtilder_i \cdot \rvx \right\|_2 \cdot \left\| \rvpi_i \right\|_2 \cdot \left\| \rvx \right\|_2 + \left\| \rvpi_i \right\|_2^2 \cdot \left\| \rvtilder_i \cdot \rvx \right\|_2^2 \\
    &\le \left\| \rvtilder_i \cdot \rvx \cdot \rvx \right\|_2 + 2 \cdot \left\| \rvtilder_i \cdot \rvx \right\|_2 \cdot \left\| \rvx \right\|_2 + \left\| \rvtilder_i \cdot \rvx \right\|_2^2 \\
    &\le \left\| \rvx \cdot \rvx \right\|_2 + 2 \cdot \left\| \rvx \right\|_2^2 + \left\| \rvx \right\|_2^2 \\
    &\le 4 \cdot \left\| \rvx \right\|_2^2. \qedhere
\end{split}
\end{equation*}
\end{proof}

\begin{lem}
Lemma 1 in the paper.
\begin{equation*}
    \rvpi_i\left( \rvo^\prime \right)^\top \rvtilder_i \le \rvpi_i\left( \rvo \right)^\top \rvtilder_i + \left\langle \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle + 2 \left\| \rvo^\prime - \rvo \right\|_2^2.
\end{equation*}
\end{lem}
\begin{proof}
Denote $\bar{\rvo}_\xi = \rvo + \xi \left( \rvo^\prime - \rvo \right)$.
\begin{equation*}
\begin{split}
    &\left| \rvpi_i\left( \rvo^\prime \right)^\top \rvtilder_i - \rvpi_i\left( \rvo \right)^\top \rvtilder_i - \left\langle \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle \right| \\
    &= \left| \int_0^1{ \frac{d \rvpi_i\left( \rvo + \xi \left( \rvo^\prime - \rvo \right) \right)^\top \rvtilder_i}{d \xi} d\xi} - \left\langle \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle \right| \\
    &= \left| \int_0^1{ \left\langle \frac{d \rvpi_i\left( \rvo + \xi \left( \rvo^\prime - \rvo \right) \right)^\top \rvtilder_i}{d \left( \rvo + \xi \left( \rvo^\prime - \rvo \right) \right)}, \rvo^\prime - \rvo \right\rangle d\xi} - \left\langle \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle \right| \\
    &= \left| \int_0^1{ \left\langle \frac{d \rvpi_i\left( \bar{\rvo}_\xi \right)^\top \rvtilder_i}{d \bar{\rvo}_\xi} - \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle d\xi} \right| \\
    &\le \int_0^1{ \left| \left\langle \frac{d \rvpi_i\left( \bar{\rvo}_\xi \right)^\top \rvtilder_i}{d \bar{\rvo}_\xi} - \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo}, \rvo^\prime - \rvo \right\rangle \right| d\xi} \\
    &\le \int_0^1{ \left\| \frac{d \rvpi_i\left( \bar{\rvo}_\xi \right)^\top \rvtilder_i}{d \bar{\rvo}_\xi} - \frac{d \rvpi_i\left( \rvo \right)^\top \rvtilder_i}{d \rvo} \right\|_2 \cdot \left\| \rvo^\prime - \rvo \right\|_2 d\xi} \\
    &= \int_0^1{ \left\| \gH\left( \rvpi_i\left( \bar{\rvo}_\xi \right)\right) \rvtilder_i - \gH\left( \rvpi_i\left( \rvo \right)\right) \rvtilder_i \right\|_2 \cdot \left\| \rvo^\prime - \rvo \right\|_2 d\xi} \\
    &= \int_0^1{ \left\| \int_0^1{\left\langle \frac{d \gH \left( \rvpi_i\left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right) \right) \rvtilder_i }{d \left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right)}, \bar{\rvo}_\xi - \rvo \right\rangle d\mu} \right\|_2 \cdot \left\| \rvo^\prime - \rvo \right\|_2 d\xi} \\
    &\le \int_0^1{  \int_0^1{ \left\| \left\langle \frac{d \gH \left( \rvpi_i\left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right) \right) \rvtilder_i }{d \left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right)}, \bar{\rvo}_\xi - \rvo \right\rangle \right\|_2 d\mu} \cdot \left\| \rvo^\prime - \rvo \right\|_2 d\xi} \\
    &\le \int_0^1{  \int_0^1{ \left\| \frac{d \gH \left( \rvpi_i\left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right) \right) \rvtilder_i }{d \left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right)} \right\|_2 \cdot \left\| \bar{\rvo}_\xi - \rvo \right\|_2 d\mu} \cdot \left\| \rvo^\prime - \rvo \right\|_2 d\xi} \\
    &= \int_0^1{  \int_0^1{ \left\| \frac{d \gH \left( \rvpi_i\left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right) \right) \rvtilder_i }{d \left( \rvo + \mu\left( \bar{\rvo}_\xi - \rvo \right) \right)} \right\|_2 d\mu} \cdot \xi \cdot \left\| \rvo^\prime - \rvo \right\|_2^2 d\xi} \\
    &\le \int_0^1{  \int_0^1{ 4 d\mu} \cdot \xi \cdot \left\| \rvo^\prime - \rvo \right\|_2^2 d\xi} \\
    &= 2 \cdot \left\| \rvo^\prime - \rvo \right\|_2^2. \qedhere
\end{split}
\end{equation*}
\end{proof}

\begin{lem}
\label{lem:gradient_upper_bound}
	Define the pseudo gradient as,
\begin{equation*}
	\frac{d \tilde{\ell}}{d \rvw_r(t)} \triangleq \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \hat{\tilde{r}}_{i,k} \cdot \pi_{i,k}(t) \cdot \left( \sum\limits_{k^\prime = 1}^{h}{ a_{k^\prime,r}  \cdot v_{k^\prime,k,i}(t) } \right) \cdot \sI\left\{ \rvw_r(0)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } }.
\end{equation*}
	For any $\tau > 0$, with probability at least $\frac{1}{2} \cdot \left( 1 - \frac{\sqrt{2}n\tau}{\sqrt{\pi}\sigma} \right)$, $\forall t \in O\left(\frac{\tau}{\eta }\right)$,
\begin{equation}
	\frac{d\ell}{d \rvw_r(t)} = \frac{d \tilde{\ell}}{d \rvw_r(t)}.
\end{equation}
\end{lem}
\begin{proof}
The policy gradient is,
\begin{equation*}
	\frac{d\ell}{d \rvw_r(t)} = \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \hat{\tilde{r}}_{i,k} \cdot \pi_{i,k}(t) \cdot \left( \sum\limits_{k^\prime \not= k}^{h}{ \pi_{i,k^\prime}(t) \cdot \left( a_{k,r} - a_{k^\prime,r} \right)  } \right) \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } }.
\end{equation*}
By Cauchy-Schwarz,
\begin{equation*}
\begin{split}
	\left\| \frac{d\ell}{d \rvw_r(t)} \right\|_2 &\le \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left| \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot \sum\limits_{k^\prime \not= k}^{h}{ \pi_{i,k^\prime}(t) \cdot \left( a_{k,r} - a_{k^\prime,r} \right)  } \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \right| \cdot \left\| \rvs_i \right\|_2 }} \\
	&\le \frac{2}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \sum\limits_{k^\prime \not= k}^{h}{ \pi_{i,k^\prime}(t)  } \cdot \left\| \rvs_i \right\|_2  }} \\
	&\le \frac{2}{n} \cdot \sum\limits_{i=1}^{n}{ \rvpi_{i}(t)^\top \rvtilder_i }.
\end{split}
\end{equation*}
$\rvw_r(t)$ will be closed to $\rvw_r(0)$,
\begin{equation*}
\begin{split}
	\left\| \rvw_r(t) - \rvw_r(0) \right\|_2 &\le \eta \cdot \sum\limits_{s=0}^{t-1}{\left\| \frac{d\ell}{d \rvw_r(s)} \right\|_2} \\
	&\le \eta \cdot 2 \cdot \sum\limits_{s=0}^{t-1}{ \rvpi_{i}(t)^\top \rvtilder_i } \\
	&\le \eta \cdot 2 \cdot t .
\end{split}
\end{equation*}
Since $\rvw_r(0)^\top \rvs_i \sim \gN(0, \sigma^2)$, $\pr\left(\left| \rvw_r(0)^\top \rvs_i \right| \le \tau\right) \le  \frac{\sqrt{2}\tau}{\sqrt{\pi}\sigma}$,
\begin{equation*}
\begin{split}
	\pr\left(\forall i \in [n], \left| \rvw_r(0)^\top \rvs_i \right| > \tau\right) &= 1 - \pr\left(\exists i \in [n], \left| \rvw_r(0)^\top \rvs_i \right| \le \tau\right) \\
	&\ge 1 - \sum\limits_{i=1}^{n}{ \pr\left(\left| \rvw_r(0)^\top \rvs_i \right| \le \tau\right) } \\
	&\ge 1 - \frac{\sqrt{2}n\tau}{\sqrt{\pi}\sigma},
\end{split}
\end{equation*}
Condition on the above event happens, let $t \le \frac{\tau}{ \eta \cdot 2}$, $\forall i \in [n]$,
\begin{equation*}
\begin{split}
	\left| \left( \rvw_r(t) - \rvw_r(0) \right)^\top \rvs_i \right| &\le \left\| \rvw_r(t) - \rvw_r(0) \right\|_2 \cdot \left\| \rvs_i \right\|_2 \\
	&\le \eta \cdot 2 \cdot t \\
	&\le \tau < \left| \rvw_r(0)^\top \rvs_i \right|,
\end{split}
\end{equation*}
which implies if $\left| \rvw_r(0)^\top \rvs_i \right| > \tau$, $\forall i \in [n]$, then,
\begin{equation*}
\begin{split}
	\sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} &= \sI\left\{ \rvw_r(0)^\top \rvs_i  + \left( \rvw_r(t) - \rvw_r(0) \right)^\top \rvs_i > 0 \right\} \\
	&= \sI\left\{ \rvw_r(0)^\top \rvs_i > 0 \right\}. \qedhere
\end{split}
\end{equation*}
\end{proof}

\begin{lem}
\label{lem:gradient_lower_bound}
	Denote $i^*(t) \triangleq \argmax\limits_{i \in [n]}\left\{\rvpi_i(t)^\top \rvtilder_i\right\}$, $k^*(t) \triangleq \argmax\limits_{k \in [h]}\left\{ r_{i^*(t),k} \right\} = \r_{i^*(t)}^{\max}$, i.e., the optimal arm of state $i^*(t)$. If $\pi_{i^*(t), k^*(t)}(t) > c > 0$, where $c$ is a constant, then with probability $\Omega\left( \frac{\delta}{n} \right)$,
\begin{equation*}
\begin{split}
	\left\| \frac{d\tilde{\ell}}{d \rvw_r(t)} \right\|_2 \ge \Omega\left( \frac{c\delta}{n^2} \right) \cdot \left( \rvpi_{i^*(t)}(t)^\top \rvtilder_i \right) \ge \Omega\left( \frac{c\delta}{n^2} \right) \cdot \ell(\rvpi(t)).
\end{split}
\end{equation*}
\end{lem}
\begin{proof}
	 For conciseness, we denote $i^*(t)$ as $i^*$, and $k^*(t)$ as $k^*$. Rewrite $\frac{d\tilde{\ell}}{d \rvw_r(t)} = \sum\limits_{k^
	\prime=1}^{h}{ a_{k^\prime,r} \cdot \rvp_{k^\prime, r} }$, where $\rvp_{k^\prime, r} \in \sR^d$ is defined as, 
\begin{equation*}
	\rvp_{k^\prime, r} \triangleq \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot v_{k^\prime,k,i}(t) \cdot \sI\left\{ \rvw_r(0)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } }.
\end{equation*}
By the randomness of $a_{k^\prime,r}$,
\begin{equation}
\label{eq:gradient_p_lowerbound}
\begin{split}
	\left\| \frac{d\tilde{\ell}}{d \rvw_r(t)} \right\|_2 &\ge \left| a_{k^*,r} \right| \cdot \left\| \rvp_{k^*, r}\right\|_2 \\
	&\ge \left\| \rvp_{k^*, r}\right\|_2,
\end{split}
\end{equation}
with probability at least $\frac{1}{2} - \frac{1}{\sqrt{2\pi}}$. We can decompose $\rvw_r(0)$ as,
\begin{equation}
\label{eq:decompose_w}
\begin{split}
	\rvw_r(0) &= \rvw_r^\prime(0) + \rvw_r^{\prime\prime}(0) \\
	&\triangleq \left( \rmI - \rvs_{i^*}\rvs_{i^*}^\top \right) \rvw_r(0) +  \rvs_{i^*}\rvs_{i^*}^\top \rvw_r(0),
\end{split}
\end{equation}
where $\rvw_r^\prime(0) \perp \rvw_r^{\prime\prime}(0)$. Define $h_{k^*,r}$ as follows,
\begin{equation*}
\begin{split}
	h_{k^*,r} &\triangleq \rvw_r(0)^\top \rvp_{k^*, r} \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot v_{k^*,k,i}(t) \cdot \sigma( \rvw_r(0)^\top \rvs_i ) \right] } }.
\end{split}
\end{equation*}
And decompose $h_{k^*,r}$ into two parts, i.e., $i^*$ and $[n] \setminus \left\{ i^* \right\}$,
\begin{equation}
\label{eq:decompose_h}
\begin{split}
	h_{k^*,r} &= \frac{1}{n} \cdot \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \cdot v_{k^*,k,i^*}(t) \cdot \sigma( \rvw_r(0)^\top \rvs_i^* ) \right] } \\
	&+ \frac{1}{n} \cdot \sum\limits_{i \not= i^*}{\sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot v_{k^*,k,i}(t) \cdot \sigma( \rvw_r(0)^\top \rvs_i ) \right] } }.
\end{split}
\end{equation}
Consider the following events,
\begin{equation*}
\begin{split}
	\gE_1 &: \left| \rvw_r(0)^\top \rvs_{i^*} \right| \le \tau, \ \text{given } \tau \in \left( 0, \sigma \right], \\
	\gE_2 &: \left| \rvw_r^\prime(0)^\top \rvs_i \right| > \tau, \ \forall i \not= i^*.
\end{split}
\end{equation*}
For $\gE_1$, note $\rvw_r(0)^\top \rvs_{i^*} \sim \gN(0, \sigma^2)$,
\begin{equation*}
\begin{split}
	\pr\left(\gE_1\right) &= \frac{1}{\sqrt{2\pi}\sigma} \int_{-\tau}^{\tau}{\exp\left\{ - \frac{x^2}{2\sigma^2} \right\} dx} \\
	&\ge \frac{1}{\sqrt{2\pi}\sigma} \int_{-\tau}^{\tau}{ \left( 1  - \frac{x^2}{2\sigma^2} \right) dx} \\
	&= \frac{\sqrt{2}}{\sqrt{\pi}\sigma} \cdot \left( \tau - \frac{\tau^3}{6\sigma^2}\right) \\
	&\ge \frac{5\sqrt{2}}{6\sqrt{\pi}} \cdot \frac{\tau}{\sigma} \in \Omega\left( \frac{\tau}{\sigma} \right).
\end{split}
\end{equation*}
For $\gE_2$, according to \cref{eq:decompose_w}, $\rvw_r^\prime(0)^\top \rvs_i \sim \gN\left(0, \left(1 - \left(\rvs_{i^*}^\top \rvs_{i} \right)^2 \right)\sigma^2 \right)$, $\forall i \not= i^*$, and $\rvw_r^\prime(0)^\top \rvs_i$ is independent with $\rvw_r^{\prime\prime}(0)^\top \rvs_{i}$.
\begin{equation*}
\begin{split}
	\pr\left(\gE_2\right) &= 1 - \pr\left( \exists i \not= i^*, \ \left| \rvw_r^\prime(0)^\top \rvs_i \right| \le \tau \right) \\
	&\ge 1 - \sum\limits_{i \not= i^*}{ \pr\left(\left| \rvw_r^\prime(0)^\top \rvs_i \right| \le \tau \right) } \\
	&\ge 1 - \frac{\sqrt{2}n\tau}{\sqrt{\pi\left( 1 - \left(\rvs_{i^*}^\top \rvs_{i} \right)^2 \right) }\sigma} \\
	&\ge 1 - \frac{2n\tau}{\sqrt{\pi}\delta\sigma} \quad \left( \left\| \rvs_{i} -  \rvs_{j} \right\|_2 \ge \delta, \ \forall i \not= j \right).
\end{split}
\end{equation*}
Let $\tau = \frac{\delta\sigma}{2n}$, then $\pr\left(\gE_2\right) \ge 1 - \frac{1}{\sqrt{\pi}}$. Therefore, $\pr\left( \gE_1 \land \gE_2 \right) \in \Omega\left( \frac{\tau}{\sigma} \right)$. Now condition on $\gE_1 \land \gE_2$ happens, we have, $\forall i \not= i^*$,
\begin{equation*}
\begin{split}
	\sI\left\{ \rvw_r(0)^\top \rvs_i > 0 \right\} &= \sI\left\{ \rvw_r^\prime(0)^\top \rvs_i + \rvw_r^{\prime\prime}(0)^\top \rvs_{i} > 0 \right\} \\
	&= \sI\left\{ \rvw_r^\prime(0)^\top \rvs_i > 0 \right\},
\end{split}
\end{equation*}
since $\left| \rvw_r^{\prime\prime}(0)^\top \rvs_{i} \right| = \left| \rvw_r(0)^\top \rvs_{i^*} \rvs_{i^*}^\top \rvs_{i} \right| \le \left| \rvw_r(0)^\top \rvs_{i^*} \right| \le \tau < \left| \rvw_r^\prime(0)^\top \rvs_i  \right|$. Fix $\rvw_r^\prime(0)^\top \rvs_i$, and randomly generate $x \triangleq \rvw_r(0)^\top \rvs_{i^*}$, rewrite \cref{eq:decompose_h},
\begin{equation}
\label{eq:h_alpha}
\begin{split}
	h_{k^*,r} &= \frac{1}{n} \cdot \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \cdot v_{k^*,k,i^*}(t) \cdot \sigma(x) \right] } \\
	&+ \frac{1}{n} \cdot \sum\limits_{i \not= i^*}{\sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot v_{k^*,k,i}(t) \cdot ( x \cdot \rvs_{i^*}^\top \rvs_{i} + \rvw_r^\prime(0)^\top \rvs_i ) \cdot \sI\left\{ \rvw_r^\prime(0)^\top \rvs_i > 0 \right\}  \right] } }.
\end{split}
\end{equation}
Note the first part of $h_{k^*,r}$ is a convex function of $x$, and the second part is linear. For the first term in \cref{eq:h_alpha}, we have,
\begin{equation*}
\begin{split}
	\sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \cdot v_{k^*,k,i^*}(t) \right] } &= \underbrace{\tilde{r}_{i^*,k^*} \cdot \pi_{i^*,k^*}(t) \cdot v_{k^*,k^*,i^*}(t)}_{\tilde{r}_{i^*,k^*} = \r_{i^*}^{\max} -  r_{i^*,k^*} = 0} + \sum\limits_{k\not=k^*}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \cdot v_{k^*,k,i^*}(t) \right] } \\
	&= - \pi_{i^*,k^*}(t) \cdot \sum\limits_{k\not=k^*}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \right] } \\
	&= - \pi_{i^*,k^*}(t) \cdot \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \right] } \\
	&= - \pi_{i^*,k^*}(t) \cdot \rvpi_{i^*}(t)^\top \rvtilder_{i^*}.
\end{split}
\end{equation*}
By assumption, if $\pi_{i^*,k^*}(t) > c > 0$, then ,
\begin{equation*}
\begin{split}
	\left| \partial{h_{k^*,r}}_{\max}{(0)} - \partial{h_{k^*,r}}_{\min}{(0)} \right| &= \frac{1}{n} \cdot \left| \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i^*,k} \cdot \pi_{i^*,k}(t) \cdot v_{k^*,k,i^*}(t) \right] } \right| \\
	&= \frac{1}{n} \cdot \pi_{i^*,k^*}(t) \cdot \rvpi_{i^*}(t)^\top \rvtilder_{i^*} \\
	&\ge \frac{c}{n} \cdot \ell(\rvpi(t)).
\end{split}
\end{equation*}
where $\partial{h_{k^*,r}}_{\max}{(0)} = \max\left\{ \partial{h_{k^*,r}}{(0)} \right\}$, $\partial{h_{k^*,r}}_{\min}{(0)} = \min\left\{ \partial{h_{k^*,r}}{(0)} \right\}$ are the maximum and minimum of $\partial{h_{k^*,r}}{(0)}$, i.e., the subdifferential of $h_{k^*,r}$ at $0$. Therefore, by \cref{lem:non_smooth_convex},
\begin{equation*}
\begin{split}
	\probability\limits_{x \sim  \gU[-\tau, \tau]}\left\{ h_{k^*,r} \ge \frac{c\tau}{8n} \cdot \ell(\rvpi(t)) \right\} > \frac{1}{8}.
\end{split}
\end{equation*}
Therefore, we have,
\begin{equation}
\label{eq:h_regret_lower_bound}
\begin{split}
	\probability\left\{ h_{k^*,r} \ge \frac{c\tau}{8n} \cdot \ell(\rvpi(t)) \right\} &\ge \probability\left\{ h_{k^*,r} \ge \frac{c\tau}{8n} \cdot \ell(\rvpi(t)) \middle| \gE_1 \land \gE_2 \right\} \cdot \probability\left\{ \gE_1 \land \gE_2 \right\} \\
	&\ge \frac{1}{8} \cdot \frac{5\sqrt{2}}{6\sqrt{\pi}} \cdot \frac{\tau}{\sigma} \cdot \left( 1 - \frac{1}{\sqrt{\pi}} \right) \\
	&= \frac{5\sqrt{2}}{48\sqrt{\pi}} \cdot \left( 1 - \frac{1}{\sqrt{\pi}} \right) \cdot \frac{\tau}{\sigma}.
\end{split}
\end{equation}
Finally, $h_{k^*,r} \sim \gN\left( 0, \left\| \rvp_{k^*, r} \right\|_2^2 \cdot \sigma^2 \right)$, with probability at least $1 - \frac{1}{e^2}$,
\begin{equation}
\label{eq:p_h_lower_bound}
\begin{split}
	h_{k^*,r} < 2 \cdot \left\| \rvp_{k^*, r} \right\|_2 \cdot \sigma.
\end{split}
\end{equation}
Combining \cref{eq:gradient_p_lowerbound}, \cref{eq:h_regret_lower_bound} and \cref{eq:p_h_lower_bound}, we have,
\begin{equation*}
\begin{split}
	\left\| \frac{d\tilde{\ell}}{d \rvw_r(t)} \right\|_2 &\ge \left\| \rvp_{k^*, r}\right\|_2 \\
	&> \frac{h_{k^*,r}}{2\sigma} \\
	&\ge \frac{c\tau}{16\sigma n} \cdot \ell(\rvpi(t)),
\end{split}
\end{equation*}
with probability at least $\left( \frac{1}{2} - \frac{1}{\sqrt{2\pi}} \right) \cdot \left( 1 - \frac{1}{e^2} \right) \cdot \frac{5\sqrt{2}}{48\sqrt{\pi}} \cdot \left( 1 - \frac{1}{\sqrt{\pi}} \right) \cdot \frac{\tau}{\sigma}$. Plugging in $\tau = \frac{\delta\sigma}{2n}$, we obtain the result.
\end{proof}

\begin{lem}
\label{lem:non_smooth_convex}
	Let $\phi(x) : \sR \to \sR$ be a convex function non-smooth at $0$. Define,
\begin{equation*}
\begin{split}
	\partial\phi_{\max}{(0)} = \max\left\{ \partial\phi(0) \right\}, \quad \partial\phi_{\min}{(0)} = \min\left\{ \partial\phi(0) \right\},
\end{split}
\end{equation*}	
where $\partial\phi(0)$ is the subdifferential of $\phi$ at $0$. Then we have,
\begin{equation*}
\begin{split}
	\probability\limits_{x \sim \gU[-\tau, \tau]}\left\{ \left| \phi(x) \ge \frac{ \left( \partial\phi_{\max}{(0)} - \partial\phi_{\min}{(0)} \right) \tau}{8} \right|\right\} \ge \frac{1}{8}.
\end{split}
\end{equation*}	
\end{lem}
\begin{proof}
	Denote $\rho = \partial\phi_{\max}{(0)} - \partial\phi_{\min}{(0)}$, we have $\partial\phi_{\max}{(0)} \ge \frac{\rho}{2}$ or $\partial\phi_{\min}{(0)} \le - \frac{\rho}{2}$. If $\partial\phi_{\min}{(0)} \le - \frac{\rho}{2}$, then $-\phi$ will satisfy the first case. So we prove for $\partial\phi_{\max}{(0)} \ge \frac{\rho}{2}$. Define $\hat{\phi}(x) = \phi(x) - \phi(0)$. $\forall x > 0$,
\begin{equation*}
\begin{split}
	\hat{\phi}(x) \ge \hat{\phi}(0) + \frac{\rho}{2} \cdot \left( x - 0\right) = \frac{\rho x}{2} \ge 0.
\end{split}
\end{equation*}
If $\phi(0) \ge 0$, then $\forall x \in \left[\frac{\tau}{2}, \tau \right]$,
\begin{equation*}
\begin{split}
	\left| \phi(x) \right| = \left| \hat{\phi}(x) + \phi(0) \right| = \hat{\phi}(x) + \phi(0) \ge \frac{\rho x}{2} \ge \frac{\rho \tau}{4}.
\end{split}
\end{equation*}
If $\phi(0) < 0$, then $\phi(x_0) = 0$ for some $x_0 > 0$. If $x_0 < \frac{\tau}{2}$, $\forall x \in \left[x_0 + \frac{\tau}{4}, \tau \right]$,
\begin{equation*}
\begin{split}
	\left| \phi(x) \right| =  \phi(x) \ge \phi(x_0) + \phi^\prime(x_0) \cdot \left( x - x_0 \right) \ge \frac{\rho \tau}{8}.
\end{split}
\end{equation*}
If $x_0 \ge \frac{\tau}{2}$, then $\phi(0) \le - \frac{\rho}{2} \cdot x_0 \le - \frac{\rho\tau}{4}$, $\forall x \in \left[0, x_0 - \frac{\tau}{4} \right]$,
\begin{equation*}
	\left| \phi(x) \right| \ge \left| \frac{-\phi(0)}{x_0} \left( x - x_0 \right) \right| = \frac{-\phi(0)}{x_0} \left( x_0 - x \right) \ge \frac{\rho\tau}{8}. \qedhere
\end{equation*}
\end{proof}


\begin{lem}
Denote $k_*^i \triangleq \argmax\limits_{k \in [h]}\left\{ \left| o_{i,k}^\prime - o_{i,k} \right| \right\}$, $\forall i \in [n]$,
\begin{equation*}
\begin{split}
    \left\| \rvo^\prime - \rvo \right\|_2^2 &\le \sum\limits_{k = 1}^{h}{ \left\| \rvo^\prime - \rvo \right\|_\infty^2} \\
    &= h \cdot \left| o_{i,k_*^i}^\prime - o_{i,k_*^i} \right|^2 \\
    &\le 4 h \left| o_{i,k_*^i}^\prime - o_{i,k_*^i} \right|^2 \\
    &= 4 h \cdot \left| \sum\limits_{r=1}^{m}{a_{k_*^i,r} \left( \sigma\left({\rvw_r^\prime}^\top \rvs_i\right) - \sigma\left({\rvw_r}^\top \rvs_i\right) \right) } \right|^2 \\
    &\le 4 h \cdot \sum\limits_{r=1}^{m}{ \left| a_{k_*^i,r} \right| \cdot \left| \sigma\left({\rvw_r^\prime}^\top \rvs_i\right) - \sigma\left({\rvw_r}^\top \rvs_i\right) \right|^2 } \\
    &\le 4h \cdot \sum\limits_{r=1}^{m}{ \left\| \rvw_r^\prime - \rvw_r \right\|_2^2 } \\
    &\le 4h m \cdot \left\| \rmW^\prime - \rmW \right\|_F^2
\end{split}
\end{equation*}
\end{lem}

\section{Policy Gradient}

\subsection{One Form}

The gradient with respect to $\rvw_r(t)$ is,
\begin{equation}
\label{eq:gradient_form_one}
\begin{split}
	\frac{d\ell}{d \rvw_r(t)} &= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}\left[ \tilde{r}_{i,k} \cdot \frac{d \pi_{i,k}(t)}{d \rvw_r(t)} \right] } \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}\left[ \tilde{r}_{i,k} \cdot \frac{d}{d \rvw_r(t)} \left\{ \frac{\exp\left\{ o_{i,k}(t) \right\}}{\sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}}} \right\} \right] } \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}\left[ \tilde{r}_{i,k} \cdot \frac{ \exp\left\{ o_{i,k}(t) \right\} \cdot a_{k,r} \cdot \rvs_i \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right) }{ \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right)^2 } \right] } \\
	&\qquad - \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}\left[ \tilde{r}_{i,k} \cdot \frac{ \exp\left\{ o_{i,k}(t) \right\} \cdot \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \cdot a_{k^\prime,r} \cdot \rvs_i \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} }{ \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right)^2 } \right] } \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot \left( \sum\limits_{k^\prime = 1}^{h}{ a_{k,r} \cdot \pi_{i,k^\prime}(t) } - \sum\limits_{k^\prime = 1}^{h}{ a_{k^\prime,r} \cdot \pi_{i,k^\prime}(t) } \right) \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } } \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot \left( \sum\limits_{k^\prime \not= k}^{h}{ \pi_{i,k^\prime}(t) \cdot \left( a_{k,r} - a_{k^\prime,r} \right)  } \right) \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } } \\
	&= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \tilde{r}_{i,k} \cdot \pi_{i,k}(t) \cdot \left( \sum\limits_{k^\prime = 1}^{h}{ a_{k^\prime,r}  \cdot v_{k^\prime,k,i}(t) } \right) \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i \right] } },
\end{split}
\end{equation}
where $v_{k^\prime,k,i}(t)$ is defined as,
\begin{equation*}
	v_{k^\prime,k,i}(t) = \begin{cases}
    1 - \pi_{i,k^\prime}(t), & \text{if $k^\prime = k$}, \\
    - \pi_{i,k^\prime}(t), & \text{otherwise}.
  \end{cases}
\end{equation*}

\subsubsection{Another Form}

First note that, $\forall k \in [h]$,
\begin{equation*}
\begin{split}
    \frac{d \rvpi_i(t)^\top \rvtilder_i}{d o_{i,k}(t)} &= \sum\limits_{k^\prime = 1}^{h}{ \tilde{r}_{i, k^\prime} \cdot \frac{d \pi_{i,k^\prime}(t) }{d o_{i,k}(t)}} \\
    &= \sum\limits_{k^\prime = 1}^{h}{ \tilde{r}_{i, k^\prime} \cdot \frac{d }{d o_{i,k}(t)}} \left\{ \frac{\exp\left\{ o_{i,k^\prime}(t) \right\}}{\sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}}} \right\} \\
    &= \tilde{r}_{i, k} \cdot \frac{ \exp\left\{ o_{i,k}(t) \right\} \cdot \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right) - \exp\left\{ o_{i,k}(t) \right\} \cdot \exp\left\{ o_{i,k}(t) \right\} }{ \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right)^2 } \\
    &\quad - \sum\limits_{k^\prime \not= k}{ \tilde{r}_{i, k^\prime} \cdot \frac{\exp\left\{ o_{i,k^\prime}(t) \right\} \cdot \exp\left\{ o_{i,k}(t) \right\} }{ \left( \sum\limits_{k^\prime = 1}^{h}{\exp\left\{ o_{i,k^\prime}(t) \right\}} \right)^2 }} \\
    &= \tilde{r}_{i, k} \cdot \left( \pi_{i,k}(t) - \pi_{i,k}(t)^2 \right) - \sum\limits_{k^\prime \not= k}{ \tilde{r}_{i, k^\prime} \cdot \pi_{i,k^\prime}(t) \cdot \pi_{i,k}(t) } \\
    &= \pi_{i,k}(t) \cdot \left( \tilde{r}_{i, k} - \rvpi_i(t)^\top \rvtilder_i \right).
\end{split}
\end{equation*}

\noindent For the vector derivative, we have,
\begin{equation*}
\begin{split}
    \frac{d \rvpi_i(t)^\top \rvtilder_i}{d \rvo_{i}(t)} &= \left( \Delta\left( \rvpi_i(t) \right) - \rvpi_i(t) \rvpi_i(t)^\top \right) \rvtilder_i .
\end{split}
\end{equation*}

\noindent Also note that, $\forall r \in [m]$, $\forall k \in [h]$,
\begin{equation*}
\begin{split}
    \frac{d o_{i,k}(t)}{d \rvw_r(t)} &= a_{k,r} \cdot \frac{d u_{i,r}(t)}{d \rvw_r(t)} \\
    &= a_{k,r} \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i.
\end{split}
\end{equation*}

\noindent Then the gradient with respect to $\rvw_r(t)$ is,
\begin{equation}
\label{eq:gradient_form_two}
\begin{split}
    \frac{d\ell}{d \rvw_r(t)} &= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \frac{d \rvpi_i(t)^\top \rvtilder_i}{d \rvw_r(t)} } \\
    &= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \frac{d \rvpi_i(t)^\top \rvtilder_i}{d o_{i,k}(t)}\cdot \frac{d o_{i,k}(t)}{d \rvw_r(t)} } } \\
    &= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \sum\limits_{k=1}^{h}{ \left[ \pi_{i,k}(t) \cdot \left( \tilde{r}_{i, k} - \rvpi_i(t)^\top \rvtilder_i \right) \cdot a_{k,r} \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i  \right] }  } \\
    &= \frac{1}{n} \cdot \sum\limits_{i=1}^{n}{ \left[ \rvtilder_i^\top \left( \Delta\left( \rvpi_i(t) \right) - \rvpi_i(t) \rvpi_i(t)^\top \right) \rva_{\cdot, r} \cdot \sI\left\{ \rvw_r(t)^\top \rvs_i > 0 \right\} \cdot \rvs_i  \right] },
\end{split}
\end{equation}
where $\rva_{\cdot, r} \in \sR^h$ refers to $\rva_{\cdot, r} \triangleq \left( a_{1,r}, a_{2,r}, \dots, a_{h,r} \right)^\top$. It is easy to check that \cref{eq:gradient_form_one} and \cref{eq:gradient_form_two} are equivalent.



\end{document}
